import os
import sys
import sqlite3
import json
import tempfile

# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿ÑƒÑ‚ÑŒ Ðº Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸
current_dir = os.path.dirname(os.path.abspath(__file__))
sys.path.insert(0, current_dir)

# Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð¸Ð· main.py
try:
    from main import (
        init_db,
        save_to_db,
        load_records,
        load_records_with_desc,
        load_types
    )
    print("âœ… ÐœÐ¾Ð´ÑƒÐ»ÑŒ main ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½")
except ImportError as e:
    print(f"âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð°: {e}")
    sys.exit(1)

# ========== Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐÐÐ¯ Ð¤Ð£ÐÐšÐ¦Ð˜Ð¯ delete_record ==========

def delete_record(selected_index):
    """Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð¸Ð· Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… - Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐÐÐ¯ Ð’Ð•Ð Ð¡Ð˜Ð¯"""
    conn = sqlite3.connect("Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ.db")
    cur = conn.cursor()

    try:
        # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð²ÑÐµ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð¾Ñ‚ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ
        cur.execute("SELECT id FROM Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ ORDER BY Ð´Ð°Ñ‚Ð° DESC")
        all_records = cur.fetchall()

        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð¸Ð½Ð´ÐµÐºÑ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
        if selected_index >= len(all_records) or selected_index < 0:
            print(f"  âš ï¸  Ð˜Ð½Ð´ÐµÐºÑ {selected_index} Ð²Ð½Ðµ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ð° (0-{len(all_records)-1})")
            return False

        # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ID Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð´Ð»Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ
        record_id = all_records[selected_index][0]

        # Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð·Ð°Ð¿Ð¸ÑÑŒ
        cur.execute("DELETE FROM Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ WHERE id = ?", (record_id,))
        conn.commit()

        print(f"  âœ… Ð£Ð´Ð°Ð»ÐµÐ½Ð° Ð·Ð°Ð¿Ð¸ÑÑŒ Ñ ID {record_id} (Ð¸Ð½Ð´ÐµÐºÑ {selected_index})")
        return True

    except Exception as e:
        print(f"  âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ð¸: {e}")
        return False
    finally:
        conn.close()

# ========== Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐÐ«Ð• Ð¢Ð•Ð¡Ð¢Ð« Ð”Ð›Ð¯ pytest ==========

def test_init_db_creates_table():
    """Ð¢ÐµÑÑ‚: ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð² Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…"""
    print("\nðŸ” Ð¢ÐµÑÑ‚: ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð² Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…")

    with tempfile.TemporaryDirectory() as temp_dir:
        original_dir = os.getcwd()
        os.chdir(temp_dir)

        try:
            # Ð’Ñ‹Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸
            init_db()

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ñ„Ð°Ð¹Ð» ÑÐ¾Ð·Ð´Ð°Ð½
            assert os.path.exists("Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ.db"), "Ð¤Ð°Ð¹Ð» Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð½Ðµ ÑÐ¾Ð·Ð´Ð°Ð½"
            print("  âœ… Ð¤Ð°Ð¹Ð» Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐ¾Ð·Ð´Ð°Ð½")

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹
            conn = sqlite3.connect("Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ.db")
            cursor = conn.cursor()

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹
            cursor.execute("SELECT name FROM sqlite_master WHERE type='table' AND name='Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ'")
            table_exists = cursor.fetchone()
            assert table_exists is not None, "Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° 'Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ' Ð½Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð°"
            print("  âœ… Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° 'Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ' ÑÐ¾Ð·Ð´Ð°Ð½Ð°")

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ ÐºÐ¾Ð»Ð¾Ð½Ð¾Ðº
            cursor.execute("PRAGMA table_info(Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ)")
            columns = cursor.fetchall()

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÐºÐ¾Ð»Ð¾Ð½Ð¾Ðº
            assert len(columns) == 6, f"ÐžÐ¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ 6 ÐºÐ¾Ð»Ð¾Ð½Ð¾Ðº, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ {len(columns)}"
            print(f"  âœ… Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ {len(columns)} ÐºÐ¾Ð»Ð¾Ð½Ð¾Ðº")

            conn.close()

        except Exception as e:
            print(f"  âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: {e}")
            raise
        finally:
            os.chdir(original_dir)


def test_save_to_db():
    """Ð¢ÐµÑÑ‚: ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² Ð±Ð°Ð·Ñƒ"""
    print("\nðŸ” Ð¢ÐµÑÑ‚: ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² Ð±Ð°Ð·Ñƒ")

    with tempfile.TemporaryDirectory() as temp_dir:
        original_dir = os.getcwd()
        os.chdir(temp_dir)

        try:
            # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ…
            init_db()

            # Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
            test_data = {
                "name": "Ð¢ÐµÑÑ‚Ð¾Ð²Ð¾Ðµ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ",
                "date": "2024-01-01",
                "typ": "ÐžÐ»Ð¸Ð¼Ð¿Ð¸Ð°Ð´Ð°",
                "level": "Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹",
                "desc": "Ð¢ÐµÑÑ‚Ð¾Ð²Ð¾Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ"
            }

            # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ
            save_to_db(**test_data)
            print("  âœ… Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð½Ð° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ")

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹
            conn = sqlite3.connect("Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ.db")
            cursor = conn.cursor()
            cursor.execute("SELECT * FROM Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ")
            result = cursor.fetchone()
            conn.close()

            assert result is not None, "Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð½Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹ Ð² Ð±Ð°Ð·Ñƒ"
            print("  âœ… Ð”Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹ Ð² Ð±Ð°Ð·Ñƒ")

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ
            assert result[1] == test_data["name"], f"ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð½Ðµ ÑÐ¾Ð²Ð¿Ð°Ð´Ð°ÐµÑ‚: {result[1]} != {test_data['name']}"
            assert result[2] == test_data["date"], f"Ð”Ð°Ñ‚Ð° Ð½Ðµ ÑÐ¾Ð²Ð¿Ð°Ð´Ð°ÐµÑ‚: {result[2]} != {test_data['date']}"
            print("  âœ… Ð’ÑÐµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾")

        except Exception as e:
            print(f"  âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: {e}")
            raise
        finally:
            os.chdir(original_dir)


def test_load_records():
    """Ð¢ÐµÑÑ‚: Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¸Ð· Ð±Ð°Ð·Ñ‹"""
    print("\nðŸ” Ð¢ÐµÑÑ‚: Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¸Ð· Ð±Ð°Ð·Ñ‹")

    with tempfile.TemporaryDirectory() as temp_dir:
        original_dir = os.getcwd()
        os.chdir(temp_dir)

        try:
            init_db()

            # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
            test_records = [
                ("Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 1", "2024-01-01", "ÐžÐ»Ð¸Ð¼Ð¿Ð¸Ð°Ð´Ð°", "Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹", "ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ 1"),
                ("Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 2", "2024-02-01", "Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚", "Ð ÐµÐ³Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹", "ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ 2"),
                ("Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 3", "2024-03-01", "ÐŸÑ€Ð¾ÐµÐºÑ‚", "ÐÐ°Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹", "ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ 3")
            ]

            conn = sqlite3.connect("Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ.db")
            cursor = conn.cursor()

            for record in test_records:
                cursor.execute(
                    "INSERT INTO Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ (Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ, Ð´Ð°Ñ‚Ð°, Ñ‚Ð¸Ð¿, ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ, Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ) VALUES (?, ?, ?, ?, ?)",
                    record
                )

            conn.commit()
            conn.close()
            print("  âœ… Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ 3 Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸")

            # Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Ð·Ð°Ð¿Ð¸ÑÐ¸
            records = load_records()

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚
            assert len(records) == 3, f"ÐžÐ¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ 3 Ð·Ð°Ð¿Ð¸ÑÐ¸, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ {len(records)}"
            print(f"  âœ… Ð—Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾ {len(records)} Ð·Ð°Ð¿Ð¸ÑÐµÐ¹")

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÑƒ (Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ DESC)
            assert records[0][0] == "2024-03-01", f"ÐŸÐµÑ€Ð²Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚ 2024-03-01, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ {records[0][0]}"
            assert records[2][0] == "2024-01-01", f"ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚ 2024-01-01, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ {records[2][0]}"
            print("  âœ… Ð—Ð°Ð¿Ð¸ÑÐ¸ Ð¾Ñ‚ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ (Ð½Ð¾Ð²Ñ‹Ðµ ÑÐ²ÐµÑ€Ñ…Ñƒ)")

        except Exception as e:
            print(f"  âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: {e}")
            raise
        finally:
            os.chdir(original_dir)


def test_delete_record_invalid_index():
    """Ð¢ÐµÑÑ‚: ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ñ Ð½ÐµÐ²ÐµÑ€Ð½Ñ‹Ð¼ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼ - Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐÐ«Ð™"""
    print("\nðŸ” Ð¢ÐµÑÑ‚: ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ñ Ð½ÐµÐ²ÐµÑ€Ð½Ñ‹Ð¼ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼")

    with tempfile.TemporaryDirectory() as temp_dir:
        original_dir = os.getcwd()
        os.chdir(temp_dir)

        try:
            init_db()

            # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¾Ð´Ð½Ñƒ Ð·Ð°Ð¿Ð¸ÑÑŒ
            conn = sqlite3.connect("Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ.db")
            cursor = conn.cursor()
            cursor.execute(
                "INSERT INTO Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ (Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ, Ð´Ð°Ñ‚Ð°, Ñ‚Ð¸Ð¿, ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ) VALUES (?, ?, ?, ?)",
                ("Ð¢ÐµÑÑ‚", "2024-01-01", "ÐžÐ»Ð¸Ð¼Ð¿Ð¸Ð°Ð´Ð°", "Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹")
            )
            conn.commit()
            conn.close()
            print("  âœ… Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð° Ð¾Ð´Ð½Ð° Ñ‚ÐµÑÑ‚Ð¾Ð²Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ")

            # ÐŸÑ‹Ñ‚Ð°ÐµÐ¼ÑÑ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ñ Ð½ÐµÐ²ÐµÑ€Ð½Ñ‹Ð¼ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼ (Ð±Ð¾Ð»ÑŒÑˆÐµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° Ð·Ð°Ð¿Ð¸ÑÐµÐ¹)
            result = delete_record(10)  # Ð˜Ð½Ð´ÐµÐºÑ Ð·Ð° Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°Ð¼Ð¸

            # Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ False
            assert result is False, f"ÐžÐ¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ False, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ {result}"
            print("  âœ… ÐŸÑ€Ð¸ Ð½ÐµÐ²ÐµÑ€Ð½Ð¾Ð¼ Ð¸Ð½Ð´ÐµÐºÑÐµ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ False")

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð½Ðµ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°
            conn = sqlite3.connect("Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ.db")
            cursor = conn.cursor()
            cursor.execute("SELECT COUNT(*) FROM Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ")
            count = cursor.fetchone()[0]
            conn.close()

            assert count == 1, f"ÐžÐ¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ 1 Ð·Ð°Ð¿Ð¸ÑÑŒ, Ð¾ÑÑ‚Ð°Ð»Ð¾ÑÑŒ {count}"
            print("  âœ… Ð—Ð°Ð¿Ð¸ÑÑŒ Ð½Ðµ ÑƒÐ´Ð°Ð»ÐµÐ½Ð° Ð¿Ñ€Ð¸ Ð½ÐµÐ²ÐµÑ€Ð½Ð¾Ð¼ Ð¸Ð½Ð´ÐµÐºÑÐµ")

        except Exception as e:
            print(f"  âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: {e}")
            raise
        finally:
            os.chdir(original_dir)


def test_delete_record_valid_index():
    """Ð¢ÐµÑÑ‚: ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ñ Ð²ÐµÑ€Ð½Ñ‹Ð¼ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼"""
    print("\nðŸ” Ð¢ÐµÑÑ‚: ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ñ Ð²ÐµÑ€Ð½Ñ‹Ð¼ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼")

    with tempfile.TemporaryDirectory() as temp_dir:
        original_dir = os.getcwd()
        os.chdir(temp_dir)

        try:
            init_db()

            # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹
            test_records = [
                ("Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 1", "2024-01-01", "ÐžÐ»Ð¸Ð¼Ð¿Ð¸Ð°Ð´Ð°", "Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹", ""),
                ("Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 2", "2024-02-01", "Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚", "Ð ÐµÐ³Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹", ""),
                ("Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 3", "2024-03-01", "ÐŸÑ€Ð¾ÐµÐºÑ‚", "ÐÐ°Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹", "")
            ]

            conn = sqlite3.connect("Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ.db")
            cursor = conn.cursor()

            for record in test_records:
                cursor.execute(
                    "INSERT INTO Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ (Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ, Ð´Ð°Ñ‚Ð°, Ñ‚Ð¸Ð¿, ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ, Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ) VALUES (?, ?, ?, ?, ?)",
                    record
                )

            conn.commit()
            conn.close()
            print("  âœ… Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ 3 Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸")

            # Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð²Ñ‚Ð¾Ñ€ÑƒÑŽ Ð·Ð°Ð¿Ð¸ÑÑŒ (Ð¸Ð½Ð´ÐµÐºÑ 1)
            result = delete_record(1)

            # Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ True
            assert result is True, f"ÐžÐ¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ True, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ {result}"
            print("  âœ… Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ñ Ð²ÐµÑ€Ð½Ñ‹Ð¼ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ True")

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð·Ð°Ð¿Ð¸ÑÑŒ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°
            conn = sqlite3.connect("Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ.db")
            cursor = conn.cursor()
            cursor.execute("SELECT COUNT(*) FROM Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ")
            count = cursor.fetchone()[0]

            assert count == 2, f"ÐžÐ¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ 2 Ð·Ð°Ð¿Ð¸ÑÐ¸, Ð¾ÑÑ‚Ð°Ð»Ð¾ÑÑŒ {count}"
            print(f"  âœ… ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð¾ÑÑ‚Ð°Ð»Ð¾ÑÑŒ {count} Ð·Ð°Ð¿Ð¸ÑÐµÐ¹")

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ ÑƒÐ´Ð°Ð»Ð¸Ð»Ð°ÑÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ
            cursor.execute("SELECT Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ FROM Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ ORDER BY Ð´Ð°Ñ‚Ð° DESC")
            remaining = [row[0] for row in cursor.fetchall()]
            conn.close()

            # ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ñ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼ 1 ("Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 2")
            # Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¾ÑÑ‚Ð°Ñ‚ÑŒÑÑ "Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 3" Ð¸ "Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 1"
            assert "Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 3" in remaining, "Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 3 Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð¾ÑÑ‚Ð°Ñ‚ÑŒÑÑ"
            assert "Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 1" in remaining, "Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 1 Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð¾ÑÑ‚Ð°Ñ‚ÑŒÑÑ"
            assert "Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 2" not in remaining, "Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 2 Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¾"
            print("  âœ… Ð£Ð´Ð°Ð»ÐµÐ½Ð° Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ (Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ 2)")

        except Exception as e:
            print(f"  âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: {e}")
            raise
        finally:
            os.chdir(original_dir)


def test_full_workflow():
    """Ð¢ÐµÑÑ‚: Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ð¹ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ - Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐÐ«Ð™"""
    print("\nðŸ” Ð¢ÐµÑÑ‚: Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ð¹ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹")

    with tempfile.TemporaryDirectory() as temp_dir:
        original_dir = os.getcwd()
        os.chdir(temp_dir)

        try:
            # Ð¨Ð°Ð³ 1: Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
            init_db()
            assert os.path.exists("Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ.db"), "Ð¤Ð°Ð¹Ð» Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð½Ðµ ÑÐ¾Ð·Ð´Ð°Ð½"
            print("  âœ… Ð¨Ð°Ð³ 1: Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°")

            # Ð¨Ð°Ð³ 2: Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ð·Ð°Ð¿Ð¸ÑÐµÐ¹
            achievements = [
                {
                    "name": "ÐžÐ»Ð¸Ð¼Ð¿Ð¸Ð°Ð´Ð° Ð¿Ð¾ Ð¼Ð°Ñ‚ÐµÐ¼Ð°Ñ‚Ð¸ÐºÐµ",
                    "date": "2024-03-15",
                    "typ": "ÐžÐ»Ð¸Ð¼Ð¿Ð¸Ð°Ð´Ð°",
                    "level": "Ð ÐµÐ³Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹",
                    "desc": "1 Ð¼ÐµÑÑ‚Ð¾"
                },
                {
                    "name": "Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ Python",
                    "date": "2024-02-10",
                    "typ": "Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚",
                    "level": "ÐÐ°Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹",
                    "desc": "ÐšÑƒÑ€Ñ Ð¿Ñ€Ð¾Ð´Ð²Ð¸Ð½ÑƒÑ‚Ð¾Ð³Ð¾ Python"
                }
            ]

            for achievement in achievements:
                save_to_db(**achievement)
            print("  âœ… Ð¨Ð°Ð³ 2: 2 Ð·Ð°Ð¿Ð¸ÑÐ¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹ Ð² Ð±Ð°Ð·Ñƒ")

            # Ð¨Ð°Ð³ 3: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…
            conn = sqlite3.connect("Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ.db")
            cursor = conn.cursor()
            cursor.execute("SELECT COUNT(*) FROM Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ")
            count = cursor.fetchone()[0]
            conn.close()

            assert count == 2, f"ÐžÐ¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ 2 Ð·Ð°Ð¿Ð¸ÑÐ¸, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ {count}"
            print(f"  âœ… Ð¨Ð°Ð³ 3: Ð’ Ð±Ð°Ð·Ðµ {count} Ð·Ð°Ð¿Ð¸ÑÐµÐ¹")

            # Ð¨Ð°Ð³ 4: Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð·Ð°Ð¿Ð¸ÑÐµÐ¹
            records = load_records()
            assert len(records) == 2, f"ÐžÐ¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ 2 Ð·Ð°Ð¿Ð¸ÑÐ¸, Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾ {len(records)}"

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÑƒ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ DESC
            assert records[0][0] == "2024-03-15", f"ÐŸÐµÑ€Ð²Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚ 2024-03-15"
            assert records[1][0] == "2024-02-10", f"Ð’Ñ‚Ð¾Ñ€Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚ 2024-02-10"
            print("  âœ… Ð¨Ð°Ð³ 4: Ð—Ð°Ð¿Ð¸ÑÐ¸ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð¸ Ð¾Ñ‚ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹")

            # Ð¨Ð°Ð³ 5: Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ñ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸ÐµÐ¼
            records_with_desc = load_records_with_desc()
            assert len(records_with_desc) == 2

            # ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ Ð·Ð°Ð¿Ð¸ÑÑŒ Ñ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ð¼
            cert_found = False
            for record in records_with_desc:
                if "Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚" in record[1]:
                    assert record[4] == "ÐšÑƒÑ€Ñ Ð¿Ñ€Ð¾Ð´Ð²Ð¸Ð½ÑƒÑ‚Ð¾Ð³Ð¾ Python"
                    cert_found = True
                    break

            assert cert_found, "Ð—Ð°Ð¿Ð¸ÑÑŒ Ñ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ð¼ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°"
            print("  âœ… Ð¨Ð°Ð³ 5: Ð—Ð°Ð¿Ð¸ÑÐ¸ Ñ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸ÐµÐ¼ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹")

            # Ð¨Ð°Ð³ 6: Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸
            result = delete_record(0)  # Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð¿ÐµÑ€Ð²ÑƒÑŽ Ð·Ð°Ð¿Ð¸ÑÑŒ (Ñ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼ 0)
            assert result is True, "Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ True"
            print("  âœ… Ð¨Ð°Ð³ 6: ÐŸÐµÑ€Ð²Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°")

            # Ð¨Ð°Ð³ 7: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ
            records_after_delete = load_records()
            assert len(records_after_delete) == 1, f"ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð¾ÑÑ‚Ð°Ñ‚ÑŒÑÑ 1 Ð·Ð°Ð¿Ð¸ÑÑŒ, Ð¾ÑÑ‚Ð°Ð»Ð¾ÑÑŒ {len(records_after_delete)}"

            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð¾ÑÑ‚Ð°Ð»Ð°ÑÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ
            remaining_record = records_after_delete[0][1]
            assert "Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚" in remaining_record, f"Ð”Ð¾Ð»Ð¶Ð½Ð° Ð¾ÑÑ‚Ð°Ñ‚ÑŒÑÑ Ð·Ð°Ð¿Ð¸ÑÑŒ Ñ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ð¼, Ð¾ÑÑ‚Ð°Ð»Ð¾ÑÑŒ: {remaining_record}"
            print("  âœ… Ð¨Ð°Ð³ 7: ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð¾ÑÑ‚Ð°Ð»Ð°ÑÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ")

            print("  âœ… Ð’ÐµÑÑŒ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ð¹ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!")

        except Exception as e:
            print(f"  âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð² Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐ¼ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ: {e}")
            import traceback
            traceback.print_exc()
            raise
        finally:
            os.chdir(original_dir)


def test_load_types():
    """Ð¢ÐµÑÑ‚: Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸Ð¿Ð¾Ð² Ð¸Ð· JSON"""
    print("\nðŸ” Ð¢ÐµÑÑ‚: Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¸Ð¿Ð¾Ð² Ð¸Ð· JSON")

    with tempfile.TemporaryDirectory() as temp_dir:
        original_dir = os.getcwd()
        os.chdir(temp_dir)

        try:
            # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»
            test_types = ["ÐžÐ»Ð¸Ð¼Ð¿Ð¸Ð°Ð´Ð°", "Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚", "ÐŸÑ€Ð¾ÐµÐºÑ‚", "Ð­ÐºÐ·Ð°Ð¼ÐµÐ½", "ÐšÐ¾Ð½Ñ„ÐµÑ€ÐµÐ½Ñ†Ð¸Ñ"]
            with open("types.json", "w", encoding="utf-8") as f:
                json.dump(test_types, f)

            # Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Ñ‚Ð¸Ð¿Ñ‹
            types = load_types()

            assert types == test_types, f"ÐžÐ¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ {test_types}, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ {types}"
            print("  âœ… Ð¢Ð¸Ð¿Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð¸Ð· Ñ„Ð°Ð¹Ð»Ð°")

            # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ñ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¼ Ñ„Ð°Ð¹Ð»Ð¾Ð¼
            os.remove("types.json")
            types = load_types()

            expected_default = ["ÐžÐ»Ð¸Ð¼Ð¿Ð¸Ð°Ð´Ð°", "Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚", "ÐŸÑ€Ð¾ÐµÐºÑ‚", "Ð­ÐºÐ·Ð°Ð¼ÐµÐ½", "ÐšÐ¾Ð½Ñ„ÐµÑ€ÐµÐ½Ñ†Ð¸Ñ"]
            assert types == expected_default, f"ÐžÐ¶Ð¸Ð´Ð°Ð»Ð¾ÑÑŒ {expected_default}, Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ {types}"
            print("  âœ… ÐŸÑ€Ð¸ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ð¸ Ñ„Ð°Ð¹Ð»Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ")

        except Exception as e:
            print(f"  âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: {e}")
            raise
        finally:
            os.chdir(original_dir)